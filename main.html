<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>የኢትዮጵያ ኦርቶዶክስ ተዋሕዶ ቤተ ክርስቲያን ቀኖች</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter for UI and Noto Serif Ethiopic for content -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Serif+Ethiopic:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4;
        }

        #main-content-area,
        #months-list {
            font-family: 'Noto Serif Ethiopic', serif;
        }

        #nav-panel h1,
        #nav-panel footer {
            font-family: 'Inter', sans-serif;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f5f5f4;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }

        .active-item {
            background-color: #e7e5e4;
            font-weight: 700;
            color: #1c1917;
        }

        .section-title {
            font-family: 'Noto Serif Ethiopic', serif;
            font-size: 2rem;
            text-align: center;
            font-weight: 700;
            color: #44403c;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e7e5e4;
        }

        .calendar-grid-container {
            margin-top: 2rem;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            text-align: center;
            font-weight: 700;
            color: #44403c;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e7e5e4;
            margin-bottom: 0.5rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            background-color: white;
            border: 1px solid #e7e5e4;
            border-radius: 0.375rem;
            padding: 0.5rem;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            font-size: 0.8rem;
            line-height: 1.2;
        }

        .day-number {
            font-weight: 700;
            color: #1c1917;
            margin-bottom: 0.25rem;
        }

        .day-content {
            flex-grow: 1;
            overflow-y: auto;
        }
        .day-content::-webkit-scrollbar { width: 4px; }
        .day-content::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 4px; }

        .day-events ul { padding-left: 1rem; margin-bottom: 0.25rem; }
        .day-events li { color: #1d4ed8; } /* blue-700 */
        .day-saints { color: #15803d; } /* green-700 */

        .month-notes {
            background-color: #fafaf9; /* stone-50 */
            border-left: 4px solid #a8a29e; /* stone-400 */
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.25rem;
        }
        .month-notes h3 { font-weight: 700; color: #44403c; margin-bottom: 0.5rem; }
        .month-notes ul { list-style-type: disc; padding-left: 1.5rem;
        }
    </style>
</head>
<body class="antialiased text-stone-800">
    <div id="app-container" class="flex h-screen bg-stone-50">
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 bg-white p-2 rounded-md shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <!-- Left Navigation Panel (Months) -->
        <nav id="nav-panel" class="w-64 bg-white border-r border-stone-200 flex flex-col transition-transform transform -translate-x-full md:translate-x-0 fixed md:static h-full z-20">
            <header class="p-4 border-b border-stone-200 text-center">
                <h1 class="text-xl font-bold text-stone-900">የቤተ ክርስቲያን ቀኖች</h1>
                <p class="text-sm text-stone-500">Ethiopian Orthodox Calendar</p>
            </header>
            <ul id="months-list" class="divide-y divide-stone-100 overflow-y-auto custom-scrollbar flex-grow">
                <!-- Month list will be populated by JavaScript -->
            </ul>
            <footer class="p-3 border-t border-stone-200 text-center text-xs text-stone-400">
                <p>ሰማንያ ወአሃዱ</p>
            </footer>
        </nav>

        <!-- Main Content (Calendar Display) -->
        <main class="flex-1 overflow-y-auto custom-scrollbar">
            <div id="main-content-area" class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8 lg:p-12">
                <div id="text-container" class="text-xl leading-loose space-y-4">
                    <div id="initial-message" class="text-center text-stone-500 mt-20">
                        <p class="text-lg">በመጫን ላይ...</p>
                        <p style="font-family: 'Inter', sans-serif;">Loading...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- APPLICATION STATE ---
        let MONTHS = [];
        let LITURGICAL_CALENDAR = {};
        let RECURRING_SAINTS = { description: '', items: [] };
        let DAY_NAMES = [];
        let currentMonthIndex = -1;

        // --- DOM ELEMENTS ---
        const monthsListEl = document.getElementById('months-list');
        const textContainerEl = document.getElementById('text-container');
        const initialMessageEl = document.getElementById('initial-message');
        const navPanel = document.getElementById('nav-panel');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const appContainer = document.getElementById('app-container');

        // --- FUNCTIONS ---
        function saveCurrentState() {
            if (currentMonthIndex >= 0) {
                localStorage.setItem('calendarState', JSON.stringify({ monthIndex: currentMonthIndex }));
            }
        }

        function loadSavedState() {
            const savedStateJSON = localStorage.getItem('calendarState');
            return savedStateJSON ? JSON.parse(savedStateJSON) : null;
        }

        function loadMonthList() {
            monthsListEl.innerHTML = '';
            MONTHS.forEach((month, index) => {
                const li = document.createElement('li');
                li.className = 'p-3 cursor-pointer hover:bg-stone-100 transition-colors duration-200';
                li.textContent = month;
                li.dataset.monthIndex = index + 1;
                li.addEventListener('click', () => handleMonthSelection(index + 1));
                monthsListEl.appendChild(li);
            });
        }

        async function handleMonthSelection(monthIndex) {
            currentMonthIndex = monthIndex;
            updateActiveMonth();
            displayMonthData(monthIndex);

            if (window.innerWidth < 768) {
                navPanel.classList.add('-translate-x-full');
            }
        }

        function updateActiveMonth() {
            document.querySelectorAll('#months-list li').forEach(item => {
                item.classList.remove('active-item');
                if (parseInt(item.dataset.monthIndex) === currentMonthIndex) {
                    item.classList.add('active-item');
                    item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        }

        function displayMonthData(monthIndex) {
            textContainerEl.innerHTML = '';
            initialMessageEl.style.display = 'none';

            const monthData = LITURGICAL_CALENDAR[monthIndex] || { items: [] };
            const monthName = MONTHS[monthIndex - 1];
            const recurringSaintsByDay = RECURRING_SAINTS.days || [];

            // 1. Month Title
            const h1 = document.createElement('h1');
            h1.className = 'section-title';
            h1.textContent = monthName;
            textContainerEl.appendChild(h1);

            // 2. Description for recurring saints/events
            if (RECURRING_SAINTS.description) {
                const desc = document.createElement('p');
                desc.className = 'text-stone-600 mb-4';
                desc.textContent = RECURRING_SAINTS.description;
                textContainerEl.appendChild(desc);
            }
            
            // 3. Display month-wide events (those without a specific day)
            const monthWideEvents = monthData.items.filter(item => !item.day);
            if (monthWideEvents.length > 0) {
                const notesDiv = document.createElement('div');
                notesDiv.className = 'month-notes';
                const notesTitle = document.createElement('h3');
                notesTitle.textContent = 'የወሩ ማስታወሻዎች';
                notesDiv.appendChild(notesTitle);
                const notesList = document.createElement('ul');
                monthWideEvents.forEach(event => {
                    const li = document.createElement('li');
                    li.textContent = event.title;
                    notesList.appendChild(li);
                });
                notesDiv.appendChild(notesList);
                textContainerEl.appendChild(notesDiv);
            }

            // 4. Create Calendar Grid
            const calendarContainer = document.createElement('div');
            calendarContainer.className = 'calendar-grid-container';

            // 4a. Day of Week Header
            const header = document.createElement('div');
            header.className = 'calendar-header hidden md:grid';
            DAY_NAMES.forEach(name => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = name;
                header.appendChild(dayHeader);
            });
            calendarContainer.appendChild(header);

            // 4b. Days Grid
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-1 md:grid-cols-7 gap-2';

            const numDays = (monthIndex === 13) ? 5 : 30; // Handle Pagume (5 days)

            for (let day = 1; day <= numDays; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';

                const dayNumber = document.createElement('span');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);

                const contentDiv = document.createElement('div');
                contentDiv.className = 'day-content custom-scrollbar';

                // Liturgical events for the day
                const dayEvents = monthData.items.filter(item => item.day === day);
                if (dayEvents.length > 0) {
                    const eventsDiv = document.createElement('div');
                    eventsDiv.className = 'day-events';
                    const eventsList = document.createElement('ul');
                    eventsList.className = 'list-disc';
                    dayEvents.forEach(event => {
                        const li = document.createElement('li');
                        li.textContent = event.title;
                        eventsList.appendChild(li);
                    });
                    eventsDiv.appendChild(eventsList);
                    contentDiv.appendChild(eventsDiv);
                }

                // Recurring saints for the day
                const daySaints = recurringSaintsByDay[day - 1];
                if (daySaints) {
                    const saintsP = document.createElement('p');
                    saintsP.className = 'day-saints';
                    saintsP.textContent = daySaints;
                    contentDiv.appendChild(saintsP);
                }

                dayCell.appendChild(contentDiv);
                grid.appendChild(dayCell);
            }
            calendarContainer.appendChild(grid);
            textContainerEl.appendChild(calendarContainer);

            document.querySelector('main').scrollTop = 0;
            saveCurrentState();
        }

        // --- EVENT LISTENERS ---
        mobileMenuBtn.addEventListener('click', () => navPanel.classList.toggle('-translate-x-full'));
        appContainer.addEventListener('click', (e) => {
            if (!navPanel.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                navPanel.classList.add('-translate-x-full');
            }
        });

        // --- INITIALIZATION ---
        async function initializeApp() {
            try {
                // Fetch all data sources in parallel
                const [monthsResponse, calendarResponse, saintsResponse] = await Promise.all([
                    fetch('./ethiopic-months.json'),
                    fetch('./liturgical-calendar.json'),
                    fetch('./monthly-saints.json')
                ]);

                // Check all responses before parsing
                if (!monthsResponse.ok) throw new Error('Failed to load months data.');
                if (!calendarResponse.ok) throw new Error('Failed to load liturgical calendar data.');
                if (!saintsResponse.ok) throw new Error('Failed to load saints data.');

                // Parse all JSON data in parallel
                const [monthsData, calendarData, saintsData] = await Promise.all([
                    monthsResponse.json(),
                    calendarResponse.json(),
                    saintsResponse.json()
                ]);

                // Update application state
                MONTHS = monthsData.amharic;
                DAY_NAMES = monthsData.days;
                LITURGICAL_CALENDAR = calendarData;
                RECURRING_SAINTS = saintsData;

                loadMonthList();

                const savedState = loadSavedState();
                const defaultMonth = savedState ? savedState.monthIndex : 1;
                await handleMonthSelection(defaultMonth);

            } catch (error) {
                console.error("Initialization Failed:", error);
                textContainerEl.innerHTML = `<div class="w-full h-full flex items-center justify-center p-4 text-center text-red-600 bg-red-50">
                    <p><strong>ስህተት፡</strong> አፕሊኬሽኑን መጀመር አልተቻለም።<br><br>${error.message}</p>
                </div>`;
            }
        }

        window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>